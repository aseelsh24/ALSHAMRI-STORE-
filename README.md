# نظام نقاط البيع للمتاجر (Offline-First PWA POS)

هذا المشروع هو نظام نقاط بيع (POS) وإدارة مخزون متكامل، مصمم خصيصاً لمتاجر التجزئة والمواد الغذائية. تم بناء التطبيق باعتماد نهج "الأوفلاين أولاً" (Offline-First)، مما يضمن استمرارية العمل حتى في حالة انقطاع الاتصال بالإنترنت.

## الميزات الرئيسية (MVP)

*   **يعمل بدون إنترنت (Offline-First):** جميع العمليات الأساسية (البيع، إضافة منتجات، إدارة عملاء) تعمل بشكل كامل بدون اتصال بالإنترنت.
*   **تطبيق ويب تقدمي (PWA):** يمكن تثبيت التطبيق على أي جهاز (كمبيوتر، تابلت، جوال) ليعمل كتطبيق أصلي.
*   **مزامنة تلقائية:** عند توفر اتصال بالإنترنت، يقوم التطبيق بمزامنة جميع البيانات تلقائياً مع قاعدة بيانات سحابية (CouchDB).
*   **واجهة نقاط بيع سريعة:** واجهة بيع بسيطة وسريعة تدعم البحث بالاسم والباركود.
*   **إدارة المنتجات والعملاء:** واجهات سهلة لإضافة وتعديل وحذف المنتجات والعملاء.
*   **تقارير أساسية:** تقرير بسيط لمتابعة المبيعات اليومية.

## الهيكل التقني

*   **الواجهة الأمامية (Frontend):** Vanilla JavaScript (ES Modules), HTML5, CSS3.
*   **قاعدة البيانات المحلية (Client-side):** [PouchDB](https://pouchdb.com/) (نسخة من IndexedDB تعمل في المتصفح).
*   **قاعدة البيانات الخلفية (Backend):** [Apache CouchDB](https://couchdb.apache.org/) (قاعدة بيانات NoSQL تتوافق مع PouchDB).
*   **العمل أوفلاين (Offline Capability):** Service Workers لتخزين واجهة التطبيق (App Shell).

---

## كيفية تشغيل المشروع

لتشغيل هذا المشروع، تحتاج إلى جزأين: الواجهة الأمامية (هذا المشروع)، وقاعدة البيانات الخلفية (CouchDB).

### 1. تشغيل قاعدة البيانات (CouchDB) باستخدام Docker

أسهل طريقة لتشغيل CouchDB هي باستخدام Docker و ملف `docker-compose.yml` المرفق.

**المتطلبات:**
*   [Docker](https://www.docker.com/get-started) مثبت على جهازك.

**الخطوات:**
1.  في الطرفية (Terminal)، ومن نفس مجلد المشروع، قم بتشغيل الأمر التالي:
    ```bash
    docker-compose up -d
    ```
2.  سيقوم هذا الأمر بتحميل وتشغيل حاوية CouchDB في الخلفية. ستكون قاعدة البيانات متاحة على العنوان: `http://localhost:5984/`.
3.  يمكنك الدخول إلى واجهة إدارة CouchDB (Fauxton) من خلال الرابط: `http://localhost:5984/_utils/`
    *   **اسم المستخدم:** `admin`
    *   **كلمة المرور:** `password`

> **ملاحظة أمان:** اسم المستخدم وكلمة المرور الافتراضية هذه مناسبة للتطوير المحلي فقط. في بيئة الإنتاج، يجب تغييرها فوراً واستخدام كلمات مرور قوية.

### 2. تشغيل الواجهة الأمامية (Frontend)

بما أن التطبيق يستخدم ES Modules، لا يمكن تشغيله مباشرة بفتح ملف `index.html` من نظام الملفات بسبب قيود أمان المتصفح (CORS). تحتاج إلى خادم ويب محلي بسيط.

**الخطوات:**
1.  تأكد من أن لديك [Node.js](https://nodejs.org/) مثبت.
2.  قم بتثبيت خادم ويب بسيط مثل `http-server` بشكل عام:
    ```bash
    npm install -g http-server
    ```
3.  من مجلد المشروع، قم بتشغيل الخادم:
    ```bash
    http-server -c-1
    ```
4.  افتح المتصفح وادخل على العنوان الذي يظهر في الطرفية (عادة `http://127.0.0.1:8080`).

---

## اختبار المزامنة والعمل أوفلاين

هذا هو جوهر التطبيق. اتبع الخطوات التالية لاختبار هذه الميزة:

1.  **الاتصال بالإنترنت:** تأكد من أن خادم CouchDB يعمل وأن لديك اتصال بالإنترنت.
2.  **افتح التطبيق في متصفحين:** افتح التطبيق في نافذتين أو متصفحين مختلفين.
3.  **أضف بيانات:** في النافذة الأولى، اذهب إلى "المنتجات" وأضف منتجاً جديداً. يجب أن يظهر المنتج الجديد تلقائياً في النافذة الثانية بعد لحظات قليلة (هذه هي المزامنة الحية).
4.  **الانقطاع عن الإنترنت:**
    *   في أدوات المطور في المتصفح (Chrome DevTools)، اذهب إلى تبويب "Network" وفعّل خيار "Offline".
    *   أو قم بإيقاف حاوية Docker: `docker-compose stop`
5.  **إجراء عمليات أوفلاين:**
    *   في إحدى النوافذ، قم بإجراء عملية بيع من "نقطة البيع".
    *   في النافذة الأخرى، قم بإضافة عميل جديد.
6.  **العودة للاتصال بالإنترنت:**
    *   في أدوات المطور، قم بإلغاء تفعيل "Offline".
    *   أو قم بإعادة تشغيل حاوية Docker: `docker-compose start`
7.  **مراقبة المزامنة:** راقب كيف يتم مزامنة البيانات التي تم إنشاؤها أوفلاين بين النافذتين وتظهر في قاعدة بيانات CouchDB.

## نقاط تحسين مستقبلية

1.  **نظام مصادقة للمستخدمين:** إضافة تسجيل دخول بصلاحيات مختلفة (مدير، كاشير).
2.  **دعم ماسح الباركود:** استخدام كاميرا الجهاز (`getUserMedia`) لمسح باركود المنتجات.
3.  **طباعة الإيصالات:** تكامل مع طابعات الإيصالات الحرارية.
4.  **تقارير متقدمة:** تقارير عن أرباح المنتجات، أفضل المنتجات مبيعاً، حركة المخزون.
5.  **إدارة المخزون المتقدمة:** أوامر شراء، جرد، تنبيهات انخفاض المخزون.
6.  **دعم تعدد العملات والمتاجر.**
7.  **برنامج ولاء العملاء:** نظام نقاط ومكافآت.
8.  **تكامل مع بوابات الدفع الإلكتروني.**
9.  **استيراد/تصدير البيانات:** استيراد المنتجات والعملاء من ملفات CSV.
10. **واجهة مستخدم محسنة:** استخدام مكتبة واجهة مستخدم مثل Vue أو React لتحسين قابلية الصيانة.
